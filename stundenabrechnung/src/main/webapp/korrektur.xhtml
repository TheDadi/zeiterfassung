<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">
	<!-- TODO: Load by AJAX / Size-->

	<rich:popupPanel id="korrektur" autosized="true">
		<f:facet name="header">
			Korrektur
		</f:facet>
		
		<a4j:outputPanel id="korrektur-ajax">

		<h:form>

			<h:panelGrid columns="1">

				<rich:extendedDataTable
					value="#{journalKorrekturController.buchungen}"
					iterationStatusVar="it" var="journal" selectionMode="single"
					selection="#{journalKorrekturController.selection}" rows="10"
					id="korrektur-table">

					<a4j:ajax execute="@form" event="selectionchange" immediate="true"
						listener="#{journalKorrekturController.selectionListener}"
						render="edit-form" />

					<rich:column>
						<f:facet name="header">
							Nr
						</f:facet>
						<h:outputText value="#{journal.nr}" />
					</rich:column>

					<rich:column>
						<f:facet name="header">
							Datum
						</f:facet>
						<h:outputText value="#{journal.datum}" />
					</rich:column>

					<rich:column>
						<f:facet name="header">
								Stunden
						</f:facet>
						<h:outputText value="#{journal.stunden}" />
					</rich:column>

					<rich:column>
						<f:facet name="header">
							Task
						</f:facet>
						<h:outputText value="#{journal.task.name}" />
					</rich:column>

					<rich:column>
						<f:facet name="header">
							Bemerkung
						</f:facet>
						<h:outputText value="#{journal.bemerkung}" />
					</rich:column>

					<f:facet name="footer">


						<rich:dataScroller for="korrektur-table" maxPages="5">

							<f:facet name="first">
								<h:outputText value="Erste Seite" />
							</f:facet>

							<f:facet name="last">
								<h:outputText value="Letzte Seite" />
							</f:facet>

						</rich:dataScroller>

					</f:facet>

				</rich:extendedDataTable>

				<a4j:outputPanel id="edit-form">

					<h:form
						rendered="#{not empty journalKorrekturController.selectedItem}">

						<h:messages styleClass="error" />

						<h:panelGrid columns="6" class="jorunalHinzufuegen">

							<h:outputText value="Nr" />
							<h:outputLabel value="Datum" for="datum" />
							<h:outputLabel value="Stunden" for="stunden" />
							<h:outputLabel value="Task" for="task" />
							<h:outputLabel value="Bemerkung" for="bemerkung" />
							<h:panelGroup />
							
							<h:outputText value="#{journalKorrekturController.selectedItem.nr}" />

							<rich:calendar
								value="#{journalKorrekturController.selectedItem.datum}"
								id="datum" required="true"
								requiredMessage="Bitte Datum angeben!" />

							<h:inputText
								value="#{journalKorrekturController.selectedItem.stunden}"
								id="stunden" required="true"
								requiredMessage="Bitte Stunden angeben!">
								<f:convertNumber maxFractionDigits="1" />
							</h:inputText>

							<rich:select value="#{journalKorrekturController.task}" id="task"
								enableManualInput="true" defaultLabel="Waehle einen Task"
								suggedstionValues="#{journalKorrekturController.tasks}" required="true"
								requiredMessage="Bitte Task auswaehlen!">
								<f:selectItems value="#{journalKorrekturController.tasks}" var="task"
									itemLabel="#{task.name}" itemValue="#{task.name}" />
							</rich:select>

							<h:inputText
								value="#{journalKorrekturController.selectedItem.bemerkung}"
								id="bemerkung" />


							<a4j:commandButton value="save"
								action="#{journalKorrekturController.save}" immediate="false" render="korrektur-ajax" />
							<a4j:commandButton value="loeschen"
								action="#{journalKorrekturController.remove}" immediate="false" render="korrektur-ajax" />

						</h:panelGrid>
					</h:form>
				</a4j:outputPanel>

				<h:commandButton value="schliessen">
					<rich:componentControl target="korrektur" operation="hide" />
				</h:commandButton>

			</h:panelGrid>

		</h:form>
		
		</a4j:outputPanel>

	</rich:popupPanel>
</ui:composition>